# EVMをゼロから実装する。

もしあなたがこれまでにEthereumと関わったことがあるなら、開発者としてであれ、ユーザーとしてであれ、おそらくEVMに出会ったことがあるでしょう。

## EVM
EVMはEthereumの中心的な要素です。Ethereumの実行エンジンであり、「スマートコントラクト」と呼ばれるEthereumプログラムの実行を担当しています。

このチュートリアルでは、EVMをゼロから構築していきます。しかし、これは参照実装ではありません。EVMの動作を理解するために必要ないと考えた実装の詳細は省略します。このチュートリアルは、EVMの基本的な概念を最初の原理から学ぶことを目的としています。

そのため、これを「ミニEVM」と呼びたいと思います。実際に動くものですが、簡略化されたバージョンです。Ethereumプログラムを入力として受け取り、それを実行する仮想マシンです。

では、EVMとは何なのでしょうか？それは、Ethereumバイトコードを実行する仮想マシンです。

## 仮想マシン
仮想マシンとは、実際のコンピュータ上で動く「仮想のコンピュータ」のようなものです。別途物理的なマシンが必要になるのではなく、既に持っているコンピュータ上でソフトウェアとしてすべてが行われます。

実際のコンピュータと同じように、仮想マシンにも独自の言語があります。EVMの場合、その言語はEthereumバイトコードと呼ばれます。

## バイトコード
バイトコードとは、EVMが理解できる命令（オペコード）の一覧です。オペコードは、ADD（加算）やSUBTRACT（減算）、STOP（停止）などの操作を意味します。

以下の表にいくつかのオペコードが示されています：重要なのは、EVMはADDやSUBTRACTの意味を理解しているわけではないということです。EVMはオペコードの識別子しか認識しません。例えば、ADDの場合は0x01です。

| OPCODE | NAME | DESCRIPTION               |
|--------|------|---------------------------|
| 0x00   | STOP | Halts Execution            |
| 0x01   | ADD  | Addition operation         |
| 0x02   | MUL  | Multiplication operation   |
| 0x03   | SUB  | Subtraction operation      |
| 0x04   | DIV  | Integer division operation |

そのため、有効なプログラムは次のように見えるでしょう：604260005260206000F3。これはEVMが解釈できるものです。

現在、144種類のオペコードがあります。それらすべてをここで確認できます。この数は固定されておらず、新しいオペコードが追加されたり、古いオペコードが頻繁に廃止されたりします。

## Solidity、Vyper、Huff
開発者として、ほとんどの場合、バイトコードを直接書きたくはないでしょう。これは非常に遅く、エラーが発生しやすいためです。ここでSolidityやVyperのような高級プログラミング言語が役立ちます。

ただし、SolidityやVyperのファイルは単なるテキストファイルです。これはEVMが理解できるものではありません。テキストファイルをEVMバイトコードに変換するプログラムが必要です。このプログラムをコンパイラと呼びます。

プログラミング言語がEVMバイトコードに変換（コンパイル）できる場合、その言語はEVMをターゲットにしていると言います。

## Ethereum vs Bitcoin
では、Ethereumが特別な理由は何でしょうか？Bitcoinのようなそれ以前のブロックチェーンと比較して。

Ethereumが「特別」なのは、それが汎用的であり、チューリング完全であるからです。つまり、任意のプログラムをEVM上で実行できるということです（ガスやメモリの制約を無視すれば）。

Bitcoinにも「ビットコインスクリプト」と呼ばれるプログラミング機能がありますが、重要なのは、ビットコインスクリプトはチューリング完全ではないという点です。ビットコインスクリプトでは実装できないプログラムが存在します。しかし、EVMではそのような制限はありません。

## 概要
私たちはミニEVMを一から構築していきます。まずはスタックから始め、次にメモリとストレージに移ります。その後、オペコードを実装していきますが、これが最も時間のかかる作業です。

これらの構成要素をすべて構築した後、それらを組み合わせて独自のEVMを作成します。最終的には、私たちのEVMを使っていくつかのプログラムを実行します。

重要なのは、私たちのミニEVMは完全に孤立した環境に存在しているということです。他のコントラクトやアカウントについては何も知りません。外部の世界とやり取りする必要がある機能は、モック（模擬）されています。これはシンプルさを保つための意図的な選択です。

## 前提条件
- Python
- 16進数の数値

## 注意事項

すべてのノートブックはここで利用可能です。もし誤りを見つけた場合は、GitHubにIssueを作成するか、さらに良ければプルリクエストを作成してください ;)
